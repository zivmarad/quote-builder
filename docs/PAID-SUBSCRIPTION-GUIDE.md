# הפיכת האפליקציה לתשלום חודשי (ישראל)

מסמך זה מתאר **מה צריך לעשות** כדי לגבות תשלום חודשי מלקוחות בישראל. אין כאן שינויי קוד – רק רשימת צעדים והחלטות.

---

## 1. בחירת ספק תשלומים

צריך שירות שמאפשר **מנוי חודשי** (Subscription) ותמיכה בישראל.

| ספק | יתרונות | הערות |
|-----|---------|--------|
| **Stripe** | API מעולה, webhooks, תמיכה בישראל, מטבע ₪ | נפוץ מאוד, תיעוד באנגלית |
| **Pelecard** | ישראלי, חשבוניות, תמיכה בעברית | מתאים מאוד לשוק הישראלי |
| **Tranzila** | ישראלי, נפוץ בארץ | |
| **Bit (ביט)** | ישראלי, פשוט יחסית | |

**המלצה:** Stripe או Pelecard – שניהם תומכים במנויים חודשיים ומטבע ₪.

---

## 2. מודל תמחור

- **מחיר חודשי** – כמה גובים לחודש (למשל 49 ₪, 99 ₪).
- **תקופת ניסיון** – אופציונלי (למשל 14 יום חינם ואז חיוב).
- **מה נכלל** – גישה מלאה לאפליקציה? הגבלת מספר הצעות? הגדר ברור מה מקבל הלקוח.

---

## 3. צד חוקי ומיסוי (ישראל)

- **עוסק מורשה או חברה** – חייבים ישות לגביית כסף (עוסק/חברה).
- **מע"מ** – אם אתה עוסק מורשה, להחליט אם עסקה בודדת במע"מ או פטור (תלוי במחזור).
- **חשבוניות** – כל תשלום חודשי = חשבונית. רוב ספקי התשלום הישראליים (Pelecard, Tranzila) מציעים אינטגרציה להנפקת חשבוניות; ב-Stripe לרוב מטפלים בחשבוניות בנפרד (מערכת חשבוניות או רואה חשבון).
- **הסכם שירות / תנאי שימוש** – מומלץ להגדיר באתר/אפליקציה שמנוי = תשלום חודשי, ביטול, החזרים (לפי חוק).

---

## 4. צד טכני (מה יהיה צריך לבנות)

1. **הרשמה לתשלום**
   - אחרי הרשמה/התחברות – הפניה לדף תשלום (Checkout) של הספק, או טופס כרטיס אשראי באתר.
   - יצירת "מנוי" (Subscription) אצל ספק התשלומים, קישור המנוי ל־`user_id` במערכת.

2. **מסד נתונים**
   - טבלה (או שדות) לשמירת: `user_id`, `subscription_id`, `status` (active / canceled / past_due), `current_period_end`, אולי `plan_id` אם יהיו כמה תוכניות.

3. **Webhooks**
   - ספק התשלומים שולח אירועים (חיוב הצליח, מנוי בוטל, תשלום נכשל). צריך:
     - **Endpoint** (למשל `POST /api/webhooks/stripe`) שמקבל את האירוע.
     - אימות שזה באמת מהספק (חתימה/סוד).
     - עדכון סטטוס המנוי במסד לפי האירוע.

4. **בדיקת גישה באפליקציה**
   - לפני שימוש ב"איזור אישי" / יצירת הצעות – לבדוק אם ל־user יש מנוי פעיל (`status === 'active'` ו־`current_period_end > now`).
   - אם אין – להציג דף "שדרג למנוי" עם לינק לתשלום/הרשמה.

5. **דף ניהול מנוי למשתמש**
   - "המנוי שלי" – הצגת סטטוס, תאריך חידוש, ביטול מנוי (לפי מה שהספק מאפשר).

---

## 5. זרימה מומלצת (לפי שלבים)

1. **החלטה:** ספק תשלומים + מחיר חודשי + עוסק/חברה.
2. **הרשמה:** חשבון אצל ספק התשלומים, קבלת API keys (ו־webhook secret).
3. **מסד נתונים:** הוספת טבלה/שדות למנויים וקישור ל־`app_users`.
4. **פיתוח:**
   - Checkout – יצירת מנוי וחיבור ל־user.
   - Webhook – עדכון סטטוס מנוי.
   - Middleware/בדיקה בדפים הרלוונטיים – רק מנויים פעילים נכנסים.
5. **חוקי:** עדכון תנאי שימוש, הנפקת חשבוניות (ידנית או אוטומטית לפי הספק).

---

## 6. סיכום קצר

| נושא | פעולה |
|------|--------|
| תשלומים | ספק: Stripe / Pelecard / Tranzila / Bit |
| מנוי | יצירת Subscription אצל הספק, שמירת סטטוס ב-DB |
| גישה | בדיקה לפני שימוש: מנוי פעיל? אחרת – דף שדרוג |
| חוקי | עוסק/חברה, חשבוניות, מע"מ, תנאי שימוש |
| Webhooks | Endpoint שמאזין לאירועי הספק ומעדכן את המנוי |

אחרי שתחליט על ספק ותמחור, השלב הבא הוא תכנון ה-API (Checkout + Webhook) ואז יישום בקוד.
