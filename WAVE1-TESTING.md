# גל 1 – הנחיות בדיקה (JWT + אימות ב-API)

אחרי העדכון, הסשן נשמר ב-**cookie מאובטח (JWT)** והשרת מאמת את המשתמש בכל קריאת sync ו-change-password. אין יותר reliance על `userId` מהלקוח.

---

## 1. הגדרה לפני הבדיקה

- וודא שב־`.env.local` מופיע משתנה **`JWT_SECRET`** (לפחות 32 תווים).  
  אם הוספת אותו ידנית, הפעל מחדש את שרת הפיתוח (`npm run dev`).

---

## 2. בדיקות חובה

### 2.1 התחברות והצגת משתמש

1. **לא מחובר:** פתח את האתר (או רענן).  
   - אמור להופיע כאילו אין משתמש מחובר (למשל כפתור "התחבר" ולא שם משתמש).
2. **התחברות:** התחבר עם משתמש קיים (שם משתמש + סיסמה).  
   - אחרי התחברות מוצלחת אמור להופיע שמך / שם המשתמש בראש האתר.
3. **רענון:** רענן את הדף (F5).  
   - המשתמש אמור להישאר מחובר (המידע מגיע מ־cookie, לא מ־localStorage).

### 2.2 יציאה

1. לחץ על "יציאה" (או איפה שמופיע logout).  
2. וודא שאחרי היציאה אתה מוצג כלא מחובר.  
3. רענן את הדף – אמור להישאר לא מחובר.

### 2.3 הרשמה

1. הירשם עם משתמש חדש (שם משתמש + סיסמה).  
2. אחרי הרשמה מוצלחת אמור להופיע שאתה מחובר עם המשתמש החדש.  
3. רענן – המשתמש החדש אמור להישאר מחובר.

### 2.4 סנכרון (סל / היסטוריה / פרופיל / הגדרות)

1. **מחובר:** הוסף פריטים לסל, או שמור פרופיל/הגדרות.  
2. רענן את הדף – הנתונים אמורים להיטען (הסנכרון עובד עם ה־cookie).  
3. **לא מחובר:** צא מהמערכת, רענן, נסה להיכנס לעמוד שדורש סנכרון.  
   - אמור לא לראות נתונים של משתמשים אחרים; אם יש הודעת "נא להתחבר" או דומה – זה צפוי.

### 2.5 שינוי סיסמה

1. התחבר עם משתמש.  
2. היכנס לעמוד שינוי סיסמה (מהפרופיל/הגדרות).  
3. הזן סיסמה נוכחית נכונה וסיסמה חדשה.  
4. וודא שמתקבלת הודעת הצלחה.  
5. צא והתחבר שוב עם **הסיסמה החדשה** – אמור להצליח.

### 2.6 גישה ל-API בלי התחברות

- בדפדפן או ב־Postman:  
  - **GET** ל־`/api/sync/basket?userId=כלשהו` **בלי** cookie של התחברות.  
- אמור לקבל **401** (או הודעת "נא להתחבר") – השרת לא מקבל יותר `userId` כלגיטימי בלי JWT.

---

## 3. סיכום

| בדיקה | תוצאה צפויה |
|--------|-------------|
| התחברות | מצליחה, משתמש מוצג |
| רענון אחרי התחברות | נשאר מחובר |
| יציאה | יוצא, רענון – נשאר לא מחובר |
| הרשמה | מחובר עם המשתמש החדש, שומר אחרי רענון |
| סל/היסטוריה/פרופיל/הגדרות | נטענים כשמחובר, לא נחשפים בלי התחברות |
| שינוי סיסמה | עובד, התחברות עם סיסמה חדשה עובדת |
| sync בלי cookie | 401 |

אם כל הסעיפים עוברים – גל 1 מוכן ואפשר להמשיך לגל 2.
